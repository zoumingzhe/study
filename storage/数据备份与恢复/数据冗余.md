# 数据冗余
数据冗余是指在存储原始数据的同时存储原始数据对应的冗余的数据，其目的是提高数据存储的可靠性，在部分数据损坏或丢失时仍然具有恢复完整原始数据的可能，代价则是需要相比原始数据更多的存储空间。

数据冗余的两种基本实现技术为多副本和纠删码。多副本冗余不仅可以提高数据存储的可靠性，还可以提高读并发性能，但是多副本若在数据修改时处理不当可能会出现一致性问题。

## 多副本（Replica）
多副本是将原始数据按副本数复制成多份，并将副本分别存储于不同物理空间以实现冗余。

## [纠删码（Erasure Code）](./纠删码.md)
纠删码是先将原始数据划分为N块数据块，再通过纠删计算出M块编码块，最后将数据块和编码块分别存储于不同物理空间以实现冗余。

## 多副本和纠删码比较
- **写惩罚**：多副本和纠删码的写惩罚取决于冗余度，冗余度越高写惩罚越高。多副本冗余度取决于副本数，纠删码冗余度取决于校验块数。
- **写性能**：相同硬件环境下，多副本的写性能只取决于写惩罚，纠删码的写性能则主要取决于编码计算。
- **读性能**：相同硬件环境下，多副本和纠删码的单并发读性能差异不大，但是多副本高并发读性能更好。
- **存储利用率和冗余度**：存储利用率是指在原始数据占总存储数据的比率，冗余度则指原始数据可被恢复所能容忍的平均最大丢失块数。理论上，多副本（n副本）空间利用率为$\frac{1}{n}$，其冗余度为$n-1$；纠删码（n+m）空间利用率为$\frac{n}{n+m}$，其冗余度为$\frac{m}{n}$。
理论上的多副本冗余度一般高于纠删码冗余度，因为只要任意一份副本未发生故障即可，但在实际应用中多会以奇数作为多副本的副本数，并通过副本间比对维护多副本的数据一致性，只有绝大多数（超过半数）副本一致才可正常服务，这就使得其冗余度降至$\frac{n-1}{2}$。
一般情况下，多副本的存储利用率要小于纠删码的存储利用率，且多副本的副本数越多存储利用率越低。
- **恢复概率（可靠性）**：在出现数据损坏情况时原始数据可被恢复的概率（即可靠性）取决于数据的冗余度，冗余度越高则恢复概率越大（即可靠性越高）。
- **恢复速度（RTO时间）**：多副本数据恢复一般从另一个副本直接拷贝即可，恢复速度较快，RTO时间较小；纠删码恢复则需进行运算，恢复速度较慢，RTO时间较长。

## 多副本和纠删码如何选择？
多副本和纠删码的本质上也是一个时空转换问题，多副本是以空间换时间，纠删码是以时间换空间，二者在不同的应用场景下有各自的优势。多副本的综合性能（读写性能、可靠性、RTO时间）更优，但是纠删码的存储成本更低。

对于读写性能、可靠性、恢复速度（RTO时间）要求均较高的关键应用场景，特别是读多写少且读并发较大的场景，多副本应该是最好的选择。

对于读写性能和恢复速度（RTO时间）要求不高，但对存储空间较为敏感的应用场景，纠删码可能更为合适，例如监控存储系统。





# 参考
 * [冗余策略：双副本与纠删码该如何选择？](https://www.sohu.com/a/438639905_120873674)
 * [分布式系统下的纠删码技术（一） -- Erasure Code (EC)](https://blog.csdn.net/u011026968/article/details/52295666)
